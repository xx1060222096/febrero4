- name: Deploy via lftp (mirror to /www)
  env:
    FTP_SERVER:   ${{ secrets.FTP_SERVER }}
    FTP_USERNAME: ${{ secrets.FTP_USERNAME }}
    FTP_PASSWORD: ${{ secrets.FTP_PASSWORD }}
  run: |
    sudo apt-get update && sudo apt-get install -y lftp
    # 注意：这里不用引号，让 ${...} 在 shell 中展开
    cat > deploy.lftp <<LFTP
    set net:max-retries 2
    set net:timeout 30
    set ftp:passive-mode on
    set ftp:ssl-force true
    set ftp:ssl-protect-data true
    set ssl:verify-certificate no
    open -u ${FTP_USERNAME},${FTP_PASSWORD} ${FTP_SERVER}
    pwd
    cls -l || true
    mirror -R \
      --only-newer \
      --parallel=1 \
      --verbose \
      --exclude-glob .git* \
      --exclude-glob .github/** \
      --exclude-glob node_modules/** \
      --exclude-glob "*.map" \
      ./ /www
    bye
    LFTP
    lftp -d -f deploy.lftp
